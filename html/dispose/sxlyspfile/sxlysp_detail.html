<div class="easyui-layout animated fadeInRight" data-options="fit:true" style="background: #edf1f2;">
    <div class="easyui-layout" style="width:100%;height: 100%">

        <div data-options="region:'center'" style="padding: 20px;position: relative;">

            <div class="shared_box" style="position: relative;">
                <div class="per_back">
                    <div class="ray_back">返回</div>
                </div>
                <div class="sxlyspBtnbox" style="margin: 20px 0;overflow: hidden;">
                    <!-- <button class="primary-btn ">同意</button>
                    <button class="border-btn">驳回</button> -->
                </div>
                <div style="border-bottom: 1px solid #eee;">
                    <div class="box-title sxlysp_title">
                        红山县公司挂职锻炼申请（国网层级）
                    </div>
                    <div style="padding: 10px 0;">
                        <span>配置单号：<i class="sxlysp_pzdh">2103090876382277</i></span>
                        <span style="margin-left:120px;">报名有效期：<i class="sxlysp_bmyxq">2019-04-01-2019-06-01</i></spanstyle="margin-left:30px;">
                    </div>
                </div>

                <div style="overflow: hidden;width: calc(100% - 200px);">
                    <div class="lf" style="width:100%">
                        <div class="shared_main_list">
                            <div class="shared_main_title">基本信息</div>
                            <div class="shared_list">
                                <div><span>配置形式： </span><b class="sxlysp_a1">试用XXXXXX</b></div>
                                <div><span>岗位名称： </span><b class="sxlysp_a2">干部管理</b></div>
                                <div><span>试用期间： </span><b class="sxlysp_a3">2019-07-01至2020-07-01</b></div>
                                <div><span>部门/处室： </span><b class="sxlysp_a4">组织部</b></div>
                                <div><span>需求人数： </span><b class="sxlysp_a5">2</b></div>
                                <div><span></span><b></b></div>
                                <div><span>所学专业： </span><b class="sxlysp_a6">组织管理</b></div>
                                <div><span>学历： </span><b class="sxlysp_a7">大专及以上</b></div>
                                <div><span>任职年限： </span><b class="sxlysp_a8">12年及以上</b></div>
                            </div>
                        </div>
                        <div class="shared_main_list" style="border-bottom: 1px solid #eee;">
                            <div class="shared_main_title" style="margin-bottom: 10px;">专业技术资格 
                                <span class="rg zhankai_act">展开</span></div>
                            <div class="shared_list sxlysp_zyjszg" style="display: none;">
                                <!-- <div class="sxlysp_b1"><span>资格等级: </span><b>222222</b></div>
                                <div class="sxlysp_b2"><span>资格要求: </span><b>222222</b></div> -->                               
                            </div>
                        </div>
                        <div class="shared_main_list" style="border-bottom: 1px solid #eee;">
                            <div class="shared_main_title" style="margin-bottom: 10px;">职业（执业）资格 
                                <span class="rg zhankai_act">展开</span></div>
                            <div class="shared_list sxlysp_zyzg" style="display: none;">
                                <!-- <div class="sxlysp_c1"><span>资格要求: </span><b>222222</b></div>
                                <div class="sxlysp_c1"><span>资格等级: </span><b>222222</b></div> -->
                            </div>
                        </div>
                        <div class="shared_main_list" style="border-bottom: 1px solid #eee;">
                            <div class="shared_main_title" style="margin-bottom: 10px;">岗位职责 
                                <span class="rg zhankai_act">展开</span></div>
                            <div class="shared_list" style="display: none;">
                                <p class="sxlysp_d">1.1 导入与部门工作相关的法律法规及相关要求，并负责向有关单位及人员宣贯；</p>
                                <!-- <p>1.2 按照体系要求开展部门的相关工作，确保体系的有效运行；</p>
                                <p>1.3 负责公司的质量或环境管理方针及目标/指标在部门内的宣贯、执行及监控；</p>
                                <p>1.4 负责编制部门职责范围内的操作规范文件与表单，依规实施并妥善保管相关文件与运行记录、表单；</p> -->
                            </div>
                        </div>
                        <div class="shared_main_list" style="border-bottom: 1px solid #eee;">
                            <div class="shared_main_title" style="margin-bottom: 10px;">职责条件 <span
                                    class="rg zhankai_act">展开</span></div>
                            <div class="shared_list" style="display: none;">
                                <p class="sxlysp_e">1.1 导入与部门工作相关的法律法规及相关要求，并负责向有关单位及人员宣贯；</p>
                                <!-- <p>1.2 按照体系要求开展部门的相关工作，确保体系的有效运行；</p>
                                <p>1.3 负责公司的质量或环境管理方针及目标/指标在部门内的宣贯、执行及监控；</p>
                                <p>1.4 负责编制部门职责范围内的操作规范文件与表单，依规实施并妥善保管相关文件与运行记录、表单；</p> -->
                            </div>
                        </div>
                        <div class="shared_main_list">
                            <div class="shared_main_title" style="margin-bottom: 10px;">人员筛选结果</div>
                            <div style="overflow: hidden;">
                                <div class="lf" style="width: 50px;text-align: center;">
                                    <img width='45' style="margin-top: 10px;" src="assets/yf/memberImg.png" alt="">
                                    <div style="color: turquoise;margin-top: 20px;"> 简历 </div>
                                </div>
                                <div class="shared_list11 rg" style="width: calc(100% - 50px);">
                                    <div><span> 姓名 : </span><b class="sxlysp_f1">刘二一</b></div>
                                    <div><span> 编号 : </span><b class="sxlysp_f2">30003276</b></div>
                                    <div><span> 调动日期 : </span><b class="sxlysp_f3">2019-12-01</b></div>
                                    <div><span> 用工形式 : </span><b class="sxlysp_f4">长期职工</b></div>
                                    <div><span> 员工性质 : </span><b class="sxlysp_f5">原中央全民</b></div>
                                    <div><span> 人员状态 : </span><b class="sxlysp_f6">在岗工作</b></div>
                                    <div><span> 岗位状态 :</span><b class="sxlysp_f7">在岗</b></div>
                                    <div><span> 流动方式 : </span><b class="sxlysp_f8">岗位竞聘</b></div>
                                    <div style="width: 40%;"><span> 批准文件 : </span><b class="col_00A09F sxlysp_f9">国家电网公司2019年度职称申报复审通过名单.pdf</b></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
    <div data-options="region:'east'" style="width:200px; padding: 10px;">
        <div class="east_box">
            <div class="east_title">审核进度</div>
            <ul class="progress_ul">
                <li>
                    <div class="li_img_list"><img src="/assets/home/icon_quan_ok.png" alt=""> 提交申请</div>
                    <div class="li_time">
                        <span>李二胡</span>
                        <p>2019-10-10</p>
                    </div>
                </li>
                <li>
                    <div class="li_img_list"><img src="/assets/home/icon_quan_x.png" alt=""> 人资审核</div>
                    <div class="li_time">
                        <span class="progress_x">张一户</span>
                        <p>2019-10-10</p>
                    </div>
                </li>
                <li>
                    <div class="li_img_list"><img src="/assets/home/icon_quan_lg.png" alt=""> 重新提交</div>
                    <div class="li_time">
                        <span class="progress_x">张一户</span>
                        <p>2019-10-10</p>
                    </div>
                </li>
                <li>
                    <div class="li_img_list"><img style=" width: 15px;margin-left: 8px;margin-right: 2px;"
                            src="/assets/home/icon_quan_sm.png" alt=""> 完成</div>
                </li>
                <li class="xian_li">
                    <div class="xian"></div>
                </li>
            </ul>
        </div>
    </div>
</div>
</div>

<script type="text/javascript">
$(function () {
    $(".zhankai_act").on("click", function () {
        var html = $(this).html()
        var htmlact = html == "展开" ? "关闭" : "展开"
        $(this).html(htmlact)
        $(this).parent().next().toggle()
    });

    var parameter=$("#mainTabs").tabs("options").id;//传参
    var staffingId=parameter.id;//配置单号
    var empId=parameter.empId;//人员ID
    var postCategory=parameter.postCategory;//岗位分类

    var objData = {
        staffingId:staffingId,//配置单号
        empId:empId,//人员ID
        postCategory:postCategory//岗位分类 
    };
    var arrData = [];
    arrData.push(objData);

    sxlyspInfo(staffingId,empId,postCategory);      
    function sxlyspInfo(staffingId,empId,postCategory){
        $.ajax({
            type:'get',
            url:BASE_URL3+'/empApply/queryApplyEmpInfo',
            contentType:'application/json',
            data:{
                staffingId:staffingId,//配置单号
                empId:empId,//人员ID
                postCategory:postCategory //岗位分类 
            },
            success:function(data){
                console.log(data);
                var resultValue = data.resultValue;
                setSxlyspInfo(resultValue);//设置数据
                
            }
        })
    }
    //设置数据
    function setSxlyspInfo(rows){
        var empStaffingVO = rows.staffingInfo.empStaffing;
        var competenceVO = rows.staffingInfo.compeListVOs[0];
        var filter = rows.filter;
        var auditStatus = filter.auditStatus;//0--待审批;
        console.log(auditStatus);
        if(auditStatus=="0"){        
            $(".sxlyspBtnbox").html('<button class="primary-btn" id="passSxlyspDetail">同意</button><button class="border-btn" id="rejeceSxlyspDetail">驳回</button>');
        }else{
            $(".sxlyspBtnbox").html("");
        }
        //同意       
        $("#passSxlyspDetail").on("click",function(){ 
            $.messager.confirm("操作确认", "确定要通过审批吗？", function(ok){
                if(ok){
                    passSxlyspD(arrData);                   
                }
            });          
            function passSxlyspD(arrData){
                $.ajax({
                    type:'post',
                    url:BASE_URL3+'/empApply/aggreHire',
                    contentType:'application/json',
                    data:JSON.stringify(arrData),
                    success:function(data){
                        if(data.resultCode =="200"){                          
                            $.messager.alert("提示信息", "审批成功" ); 
                            sxlyspInfo(staffingId,empId,postCategory);//刷新页面  
                        }else{
                            $.messager.alert("提示信息", "审批失败"); 
                        }
                    },
                    error: function(rel){
                        console.log(rel);
                    }
                });
            }
        });
        //驳回
        $("#rejeceSxlyspDetail").on("click",function(){ 
            $.messager.confirm("操作确认", "确定要驳回审批吗？", function(ok){
                if(ok){
                    rejectSxlyspD(arrData);                   
                }
            });          
            function rejectSxlyspD(arrData){
                $.ajax({
                    type:'post',
                    url:BASE_URL3+'/empApply/aggreEmpsCheckByResponseId',
                    contentType:'application/json',
                    data:JSON.stringify(arrData),
                    success:function(data){
                        if(data.resultCode =="200"){                          
                            $.messager.alert("提示信息", "驳回成功" ); 
                            sxlyspInfo(staffingId,empId,postCategory);//刷新页面  
                        }else{
                            $.messager.alert("提示信息", "驳回失败"); 
                        }
                    },
                    error: function(rel){
                        console.log(rel);
                    }
                });
            }                
        });
        
        var zyjszg="";
        var zyzg="";
        $(".sxlysp_title").text(formatString(empStaffingVO.staffingName,"--"));//配置单名称
        $(".sxlysp_pzdh").text(formatString(empStaffingVO.staffingId,"--"));//配置单单号
        $(".sxlysp_bmyxq").text(formatString(timeType(empStaffingVO.beginDate),"--")+" - " + formatString(timeType(empStaffingVO.endDate),"--"));//报名有效期

        $(".sxlysp_a1").text(formatString(competenceVO.staffingMethod,"--"));//配置形式
        $(".sxlysp_a2").text(formatString(competenceVO.postName,"--"));//岗位名称
        $(".sxlysp_a3").text(formatString(timeType(competenceVO.beginDate),"--")+" - " + formatString(timeType(competenceVO.endDate),"--"));//试用期
        $(".sxlysp_a4").text(formatString(competenceVO.recruitDeptName,"--"));//部门/处室
        $(".sxlysp_a5").text(formatString(competenceVO.recruitNumber,"--"));//需求人数
        $(".sxlysp_a6").text(formatString(competenceVO.recruitProfession ,"--"));//所学专业
        
        $(".sxlysp_a7").text(competenceVO.educationName?competenceVO.educationName+"及以上" : "--");//学历
        $(".sxlysp_a8").text(competenceVO.experienceYear?competenceVO.experienceYear+"年及以上" : "--");//任职年限

        for(var j =0;j<competenceVO.skill.length;j++){
             if(competenceVO.skill[j].abilityName && competenceVO.skill[j].abilityLevel){
                 zyjszg+='<div style="width: 50%;"><span>资格要求: </span><b>'+competenceVO.skill[j].abilityName+'</b></div>';
                 zyjszg+='<div style="width: 50%;"><span>资格等级: </span><b>'+forspSkill(competenceVO.skill[j].abilityLevel)+'</b></div>';
             }
         }
         for(var j =0;j<competenceVO.qualification.length;j++){
             if(competenceVO.qualification[j].abilityName && competenceVO.qualification[j].abilityLevel){
                 zyzg+='<div style="width: 50%;"><span>资格要求: </span><b>'+competenceVO.qualification[j].abilityName+'</b></div>';
                 zyzg+='<div style="width: 50%;"><span>资格等级: </span><b>'+forspQualifi(competenceVO.qualification[j].abilityLevel)+'</b></div>';
             }
         }
        $(".sxlysp_zyjszg").html(formatString(zyjszg,"--"));//专业技术资格
        $(".sxlysp_zyzg").html(formatString(zyzg,"--"));//职业（执业）资格
        $(".sxlysp_d").text(formatString(competenceVO.jobDesc,"--"));//岗位职责
        $(".sxlysp_e").text(formatString(competenceVO.competenceDesc ,"--"));//任职条件

        $(".sxlysp_f1").text(formatString(filter.applyName,"--"));//姓名
        $(".sxlysp_f2").text(formatString(filter.empId,"--"));//编号
        $(".sxlysp_f3").text(formatString(timeType(filter.busiChangeDate),"--"));//调动日期
        $(".sxlysp_f4").text(formatString(filter.employForm,"--"));//用工形式
        $(".sxlysp_f5").text(formatString(filter.employNature,"--"));//员工性质
        $(".sxlysp_f6").text(formatString(filter.empStatus,"--"));//人员状态
        $(".sxlysp_f7").text(formatString(filter.positionStatus ,"--"));//岗位状态
        $(".sxlysp_f8").text(formatString(filter.changeReason,"--"));//流动方式
        $(".sxlysp_f9").text(formatString(filter.attachId,"--"));//批准文献
    }
	function forspSkill(val){
		var lvStr ="";
		if(val==="1"){
			lvStr="高级技师";
		}else if(val==="2"){
			lvStr="技师";
		}else if(val==="3"){
			lvStr="高级工";
		}else if(val==="4"){
			lvStr="中级工";
		}else if(val==="5"){
			lvStr="初级工";
		}
		return lvStr;
	}
	function forspQualifi(val){
		var lvStr ="";
		if(val==="1"){
			lvStr="正高级";
		}else if(val==="2"){
			lvStr="副高级";
		}else if(val==="3"){
			lvStr="中级";
		}else if(val==="4"){
			lvStr="初级";
		}
		return lvStr;
	}
});
</script>